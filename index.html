<!DOCTYPE html>
<html>
  <head>
    <title>My Awesome Presentation</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <style type="text/css">
      @import url(http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(http://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(http://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
    </style>
  </head>
  <body>
    <textarea id="source">
# Test-Driven Development in Python


```

----------------------------------------------------------------------
Ran 0 tests in 0.000s

OK
```
---
# First test; it's failing


```python
# test_leaderboard.py
@@ -0,0 +1,7 @@
+import unittest
+import leaderboard
+
+class TestLeaderboard(unittest.TestCase):
+    def test_empty(self):
+        it = leaderboard.Leaderboard()
+        self.assertEqual(0, len(it.leaders()))
```
```
E
======================================================================
ERROR: Failure: ImportError (No module named leaderboard)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/nose/loader.py", line 411, in loadTestsFromName
    addr.filename, addr.module)
  File "/opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/nose/importer.py", line 47, in importFromPath
    return self.importFromDir(dir_path, fqname)
  File "/opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/nose/importer.py", line 94, in importFromDir
    mod = load_module(part_fqname, fh, filename, desc)
  File "/private/tmp/repo.5KBFJI/commit/test/test_leaderboard.py", line 2, in <module>
    import leaderboard
ImportError: No module named leaderboard

----------------------------------------------------------------------
Ran 1 test in 0.003s

FAILED (errors=1)
```
---
# Create leaderboard.py

Now the error message is different:

    AttributeError: 'module' object has no attribute 'Leaderboard'

Let's make one.

```python
# leaderboard.py
```
```
E
======================================================================
ERROR: test_empty (test_leaderboard.TestLeaderboard)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/private/tmp/repo.5KBFJI/commit/test/test_leaderboard.py", line 6, in test_empty
    it = leaderboard.Leaderboard()
AttributeError: 'module' object has no attribute 'Leaderboard'

----------------------------------------------------------------------
Ran 1 test in 0.005s

FAILED (errors=1)
```
---
# Getting closer

Now we see this:

    AttributeError: 'Leaderboard' object has no attribute 'leaders'

Let's fix that.

```python
# leaderboard.py
class Leaderboard(object):
    pass
```
```
E
======================================================================
ERROR: test_empty (test_leaderboard.TestLeaderboard)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/private/tmp/repo.5KBFJI/commit/test/test_leaderboard.py", line 7, in test_empty
    self.assertEqual(0, len(it.leaders()))
AttributeError: 'Leaderboard' object has no attribute 'leaders'

----------------------------------------------------------------------
Ran 1 test in 0.004s

FAILED (errors=1)
```
---
# Still closer

And now:

    TypeError: object of type 'NoneType' has no len()

So let's give it something with a len().

```python
# leaderboard.py
class Leaderboard(object):
    def leaders(self):
        pass
```
```
E
======================================================================
ERROR: test_empty (test_leaderboard.TestLeaderboard)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/private/tmp/repo.5KBFJI/commit/test/test_leaderboard.py", line 7, in test_empty
    self.assertEqual(0, len(it.leaders()))
TypeError: object of type 'NoneType' has no len()

----------------------------------------------------------------------
Ran 1 test in 0.004s

FAILED (errors=1)
```
---
# Yay, our first passing test!

We've done the bare minimum to get the test to pass, and nothing else.

```python
# leaderboard.py
class Leaderboard(object):
    def leaders(self):
        return []
```
```
.
----------------------------------------------------------------------
Ran 1 test in 0.004s

OK
```
---
# Let's add another test

First we make sure that it fails, so we know it's really testing
something.

```python
# leaderboard.py
class Leaderboard(object):
    def leaders(self):
        return []
```
```python
# test_leaderboard.py
     def test_empty(self):
         it = leaderboard.Leaderboard()
         self.assertEqual(0, len(it.leaders()))
+
+    def test_has_one_leader(self):
+        it = leaderboard.Leaderboard()
+        it.track_score(5, object())
+        self.assertEqual(1, len(it.leaders()))
```
```
.E
======================================================================
ERROR: test_has_one_leader (test_leaderboard.TestLeaderboard)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/private/tmp/repo.5KBFJI/commit/test/test_leaderboard.py", line 11, in test_has_one_leader
    it.track_score(5, object())
AttributeError: 'Leaderboard' object has no attribute 'track_score'

----------------------------------------------------------------------
Ran 2 tests in 0.004s

FAILED (errors=1)
```
---
# A new error

Now we can see the logic error in `leaders` in the failure message.

```python
# leaderboard.py
class Leaderboard(object):
    def leaders(self):
        return []

    def track_score(self, score, obj):
        pass
```
```
.F
======================================================================
FAIL: test_has_one_leader (test_leaderboard.TestLeaderboard)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/private/tmp/repo.5KBFJI/commit/test/test_leaderboard.py", line 12, in test_has_one_leader
    self.assertEqual(1, len(it.leaders()))
AssertionError: 1 != 0

----------------------------------------------------------------------
Ran 2 tests in 0.005s

FAILED (failures=1)
```
---
# Tests pass!

But it's still not doing what we want...

```python
# leaderboard.py
class Leaderboard(object):
    def __init__(self):
        self.x = 0

    def leaders(self):
        return range(self.x)

    def track_score(self, score, obj):
        self.x = self.x + 1
```
```
..
----------------------------------------------------------------------
Ran 2 tests in 0.004s

OK
```
---
# Hopefully a stricter test?

We want this test to work, but let's make sure.

```python
# leaderboard.py
class Leaderboard(object):
    def __init__(self):
        self.x = 0

    def leaders(self):
        return range(self.x)

    def track_score(self, score, obj):
        self.x = self.x + 1
```
```python
# test_leaderboard.py
         it = leaderboard.Leaderboard()
         it.track_score(5, object())
         self.assertEqual(1, len(it.leaders()))
+
+    def test_returns_leader_object(self):
+        it = leaderboard.Leaderboard()
+        bob = object()
+        it.track_score(1, bob)
+        self.assertEqual(bob, it.leaders()[0])
```
```
..F
======================================================================
FAIL: test_returns_leader_object (test_leaderboard.TestLeaderboard)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/private/tmp/repo.5KBFJI/commit/test/test_leaderboard.py", line 18, in test_returns_leader_object
    self.assertEqual(bob, it.leaders()[0])
AssertionError: <object object at 0x109442170> != 0

----------------------------------------------------------------------
Ran 3 tests in 0.006s

FAILED (failures=1)
```
---
# Yep, still failing

The test will only pass if we make `leaders` return what we gave it.

```python
# leaderboard.py
class Leaderboard(object):
    def __init__(self):
        self.x = 0

    def leaders(self):
        return [object() for _ in range(self.x)]

    def track_score(self, score, obj):
        self.x = self.x + 1
```
```
..F
======================================================================
FAIL: test_returns_leader_object (test_leaderboard.TestLeaderboard)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/private/tmp/repo.5KBFJI/commit/test/test_leaderboard.py", line 18, in test_returns_leader_object
    self.assertEqual(bob, it.leaders()[0])
AssertionError: <object object at 0x10a3c4170> != <object object at 0x10a3c4180>

----------------------------------------------------------------------
Ran 3 tests in 0.004s

FAILED (failures=1)
```
---
# Tests pass again


```python
# leaderboard.py
class Leaderboard(object):
    def __init__(self):
        self._leaders = []

    def leaders(self):
        return self._leaders

    def track_score(self, score, obj):
        self._leaders.append(obj)
```
```
...
----------------------------------------------------------------------
Ran 3 tests in 0.004s

OK
```
---
# New failing test


```python
# leaderboard.py
class Leaderboard(object):
    def __init__(self):
        self._leaders = []

    def leaders(self):
        return self._leaders

    def track_score(self, score, obj):
        self._leaders.append(obj)
```
```python
# test_leaderboard.py
         bob = object()
         it.track_score(1, bob)
         self.assertEqual(bob, it.leaders()[0])
+
+    def test_stores_up_to_max(self):
+        it = leaderboard.Leaderboard(max=5)
+        for i in range(5):
+            it.track_score(2, object())
+            self.assertEqual(i + 1, len(it.leaders()))
```
```
...E
======================================================================
ERROR: test_stores_up_to_max (test_leaderboard.TestLeaderboard)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/private/tmp/repo.5KBFJI/commit/test/test_leaderboard.py", line 21, in test_stores_up_to_max
    it = leaderboard.Leaderboard(max=5)
TypeError: __init__() got an unexpected keyword argument 'max'

----------------------------------------------------------------------
Ran 4 tests in 0.004s

FAILED (errors=1)
```
---
# Tests pass


```python
# leaderboard.py
class Leaderboard(object):
    def __init__(self, max=None):
        self._leaders = []

    def leaders(self):
        return self._leaders

    def track_score(self, score, obj):
        self._leaders.append(obj)
```
```
....
----------------------------------------------------------------------
Ran 4 tests in 0.004s

OK
```
---
# Failing test


```python
# leaderboard.py
class Leaderboard(object):
    def __init__(self, max=None):
        self._leaders = []

    def leaders(self):
        return self._leaders

    def track_score(self, score, obj):
        self._leaders.append(obj)
```
```python
# test_leaderboard.py
         for i in range(5):
             it.track_score(2, object())
             self.assertEqual(i + 1, len(it.leaders()))
+
+    def test_does_not_store_more_than_max(self):
+        it = leaderboard.Leaderboard(max=5)
+        for i in range(6):
+            it.track_score(2, object())
+        self.assertEqual(5, len(it.leaders()))
```
```
F....
======================================================================
FAIL: test_does_not_store_more_than_max (test_leaderboard.TestLeaderboard)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/private/tmp/repo.5KBFJI/commit/test/test_leaderboard.py", line 30, in test_does_not_store_more_than_max
    self.assertEqual(5, len(it.leaders()))
AssertionError: 5 != 6

----------------------------------------------------------------------
Ran 5 tests in 0.005s

FAILED (failures=1)
```
---
# Tests passing


```python
# leaderboard.py
class Leaderboard(object):
    def __init__(self, max=None):
        self._leaders = []
        self._max = max

    def leaders(self):
        return self._leaders

    def track_score(self, score, obj):
        if not self._max or len(self._leaders) < self._max:
            self._leaders.append(obj)
```
```
.....
----------------------------------------------------------------------
Ran 5 tests in 0.005s

OK
```
---
# Another failing test


```python
# leaderboard.py
class Leaderboard(object):
    def __init__(self, max=None):
        self._leaders = []
        self._max = max

    def leaders(self):
        return self._leaders

    def track_score(self, score, obj):
        if not self._max or len(self._leaders) < self._max:
            self._leaders.append(obj)
```
```python
# test_leaderboard.py
         for i in range(6):
             it.track_score(2, object())
         self.assertEqual(5, len(it.leaders()))
+
+    def test_max_is_5_by_default(self):
+        it = leaderboard.Leaderboard()
+        for i in range(6):
+            it.track_score(2, object())
+        self.assertEqual(5, len(it.leaders()))
```
```
...F..
======================================================================
FAIL: test_max_is_5_by_default (test_leaderboard.TestLeaderboard)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/private/tmp/repo.5KBFJI/commit/test/test_leaderboard.py", line 36, in test_max_is_5_by_default
    self.assertEqual(5, len(it.leaders()))
AssertionError: 5 != 6

----------------------------------------------------------------------
Ran 6 tests in 0.005s

FAILED (failures=1)
```
---
# Passing


```python
# leaderboard.py
class Leaderboard(object):
    def __init__(self, max=5):
        self._leaders = []
        self._max = max

    def leaders(self):
        return self._leaders

    def track_score(self, score, obj):
        if len(self._leaders) < self._max:
            self._leaders.append(obj)
```
```
......
----------------------------------------------------------------------
Ran 6 tests in 0.005s

OK
```
---
# How would you implement this test?


```python
# leaderboard.py
class Leaderboard(object):
    def __init__(self, max=5):
        self._leaders = []
        self._max = max

    def leaders(self):
        return self._leaders

    def track_score(self, score, obj):
        if len(self._leaders) < self._max:
            self._leaders.append(obj)
```
```python
# test_leaderboard.py
         for i in range(6):
             it.track_score(2, object())
         self.assertEqual(5, len(it.leaders()))
+
+    @unittest.skip('TODO: implement me')
+    def test_max_0_is_unlimited(self):
+        pass
```
```
...S...
----------------------------------------------------------------------
Ran 7 tests in 0.005s

OK (SKIP=1)
```
---
# How about this?


```python
# leaderboard.py
class Leaderboard(object):
    def __init__(self, max=5):
        self._leaders = []
        self._max = max

    def leaders(self):
        return self._leaders

    def track_score(self, score, obj):
        if len(self._leaders) < self._max:
            self._leaders.append(obj)
```
```python
# test_leaderboard.py
     @unittest.skip('TODO: implement me')
     def test_max_0_is_unlimited(self):
         pass
+
+    @unittest.skip('TODO: implement me')
+    def test_sorts_by_score(self):
+        pass
```
```
...S..S.
----------------------------------------------------------------------
Ran 8 tests in 0.005s

OK (SKIP=2)
```
---
# Add another test

This time, the code and test changed in the same commit. You'd usually
do it this way in a project, but we're breaking it down further for
demonstration.

```python
# leaderboard.py
class Leaderboard(object):
    def __init__(self, max=5):
        self._leaders = []
        self._max = max

    def leaders(self):
        return list(self._leaders)

    def track_score(self, score, obj):
        if len(self._leaders) < self._max:
            self._leaders.append(obj)
```
```python
# test_leaderboard.py
     @unittest.skip('TODO: implement me')
     def test_sorts_by_score(self):
         pass
+
+    def test_leaders_is_copy(self):
+        it = leaderboard.Leaderboard()
+        it.leaders().append(object())
+        self.assertEqual(0, len(it.leaders()))
```
```
....S..S.
----------------------------------------------------------------------
Ran 9 tests in 0.006s

OK (SKIP=2)
```
---
# Test in the direction we want to go

This test might make it easier to do `test_sorts_by_score`.

```python
# leaderboard.py
class Leaderboard(object):
    def __init__(self, max=5):
        self._leaders = []
        self._max = max

    def leaders(self):
        return list(self._leaders)

    def track_score(self, score, obj):
        if len(self._leaders) < self._max:
            self._leaders.append(obj)
```
```python
# test_leaderboard.py
         it = leaderboard.Leaderboard()
         it.leaders().append(object())
         self.assertEqual(0, len(it.leaders()))
+
+    def test_remembers_score(self):
+        it = leaderboard.Leaderboard()
+        bob = object()
+        it.track_score(5, bob)
+        self.assertEqual(5, it.get_score(bob))
```
```
....S.E.S.
======================================================================
ERROR: test_remembers_score (test_leaderboard.TestLeaderboard)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/private/tmp/repo.5KBFJI/commit/test/test_leaderboard.py", line 55, in test_remembers_score
    self.assertEqual(5, it.get_score(bob))
AttributeError: 'Leaderboard' object has no attribute 'get_score'

----------------------------------------------------------------------
Ran 10 tests in 0.005s

FAILED (SKIP=2, errors=1)
```
---
# Make the test pass

Remember, always do the minimum to make the test pass!

```python
# leaderboard.py
class Leaderboard(object):
    def __init__(self, max=5):
        self._leaders = []
        self._max = max

    def leaders(self):
        return list(self._leaders)

    def track_score(self, score, obj):
        if len(self._leaders) < self._max:
            self._leaders.append(obj)

    def get_score(self, obj):
        return 5
```
```
....S...S.
----------------------------------------------------------------------
Ran 10 tests in 0.006s

OK (SKIP=2)
```
---
# Really, the minimum

This makes our tests more robust.

```python
# leaderboard.py
class Leaderboard(object):
    def __init__(self, max=5):
        self._leaders = []
        self._max = max

    def leaders(self):
        return list(self._leaders)

    def track_score(self, score, obj):
        if len(self._leaders) < self._max:
            self._leaders.append(obj)
        self._last_score = score

    def get_score(self, obj):
        return self._last_score
```
```python
# test_leaderboard.py
         bob = object()
         it.track_score(5, bob)
         self.assertEqual(5, it.get_score(bob))
+
+        dara = object()
+        it.track_score(6, dara)
+        self.assertEqual(6, it.get_score(dara))
```
```
....S...S.
----------------------------------------------------------------------
Ran 10 tests in 0.006s

OK (SKIP=2)
```
---
# There we go

We can almost do `test_sorts_by_score`, but this seems inefficient.

```python
# leaderboard.py
class Leaderboard(object):
    def __init__(self, max=5):
        self._leaders = []
        self._max = max

    def leaders(self):
        return [x['obj'] for x in self._leaders]

    def track_score(self, score, obj):
        if len(self._leaders) < self._max:
            self._leaders.append({'score': score, 'obj': obj})

    def get_score(self, obj):
        for x in self._leaders:
            if x['obj'] == obj:
                return x['score']
```
```python
# test_leaderboard.py
     def test_remembers_score(self):
         it = leaderboard.Leaderboard()
         bob = object()
-        it.track_score(5, bob)
-        self.assertEqual(5, it.get_score(bob))
-
         dara = object()
+
+        it.track_score(5, bob)
         it.track_score(6, dara)
         self.assertEqual(6, it.get_score(dara))
+        self.assertEqual(5, it.get_score(bob))
```
```
....S...S.
----------------------------------------------------------------------
Ran 10 tests in 0.006s

OK (SKIP=2)
```
---
# Refactor to make get_score faster

We know we haven't broken anything; the tests still pass!

```python
# leaderboard.py
class Leaderboard(object):
    def __init__(self, max=5):
        self._leaders = dict()
        self._max = max

    def leaders(self):
        return [k for k, v in self._leaders.items()]

    def track_score(self, score, obj):
        if len(self._leaders) < self._max:
            self._leaders[obj] = score

    def get_score(self, obj):
        return self._leaders[obj]
```
```
....S...S.
----------------------------------------------------------------------
Ran 10 tests in 0.005s

OK (SKIP=2)
```
---
# Another test to implement


```python
# leaderboard.py
class Leaderboard(object):
    def __init__(self, max=5):
        self._leaders = dict()
        self._max = max

    def leaders(self):
        return [k for k, v in self._leaders.items()]

    def track_score(self, score, obj):
        if len(self._leaders) < self._max:
            self._leaders[obj] = score

    def get_score(self, obj):
        return self._leaders[obj]
```
```python
# test_leaderboard.py
         it.track_score(6, dara)
         self.assertEqual(6, it.get_score(dara))
         self.assertEqual(5, it.get_score(bob))
+
+    @unittest.skip('TODO: implement me')
+    def test_remembers_highest_score(self):
+        pass
```
```
....S.S..S.
----------------------------------------------------------------------
Ran 11 tests in 0.006s

OK (SKIP=3)
```
    </textarea>
    <script src="http://gnab.github.io/remark/downloads/remark-0.5.9.min.js" type="text/javascript">
    </script>
    <script type="text/javascript">
        var slideshow = remark.create();
    </script>
  </body>
</html>
