#!/bin/sh

PRES_MD=$(mktemp -t pres.md.XXXXXX)

function gen_md {
  { for commit in $(git rev-list master | tail -r)
    do
      echo ---
      git log --format=$'# %s\n\n%b' -n 1 $commit
      { git checkout $commit >/dev/null 2>&1
        git clean -df
        echo $'```'
        nosetests 2>&1
        echo $'```'
        git checkout $(git reflog -n2 --pretty=%H | tail -n1) >/dev/null 2>&1
      }
      echo $'```python'
      echo $'# test_leaderboard.py'
      git show $commit:test/test_leaderboard.py
      if git show $commit:src/leaderboard.py >/dev/null 2>&1
      then
        echo $'```\n\n```python'
        echo $'# leaderboard.py'
        git show $commit:src/leaderboard.py
        echo $'```'
      fi
    done
  } | sed '1d' > $PRES_MD
}

{ gen_md &&
  vim $PRES_MD &&
  mv $PRES_MD pres.md
  open remark.html
}
